import{_ as V,E as Y,c as p,a as n,b as a,w as r,d as F,e as u,t as g,f as k,r as d,o as m,F as y,g as A,h as S}from"./index-OPUUmHry.js";const M={data(){return{disabledDate(t){return t.getTime()>Date.now()},searchData:{date:"",cashFlowSource:"",bankAccount:""},searchOrigin:[],cashFlowSources:[],bankAccounts:[],isComparing:!1,bankFlow:[],countBankFlow:null,totalBankFlow:null,systemFlow:[],countSystemFlow:null,totalSystemFlow:null,dialogTableVisible:!1,systemFlowDetails:[],dialogVisible:!1,selectedId:null,stations:[],transferData:[]}},methods:{getSearchOrigin(){this.searchOrigin=[{id:1,companyId:1,bankMemo:"iPASS MONEY",voucherDesc:"一卡通",message:null,bankId:1,name:"力揚彰銀臨停",bankCode:"009",account:"41150119912400"},{id:2,companyId:1,bankMemo:"國泰世華商連加",voucherDesc:"連加",message:null,bankId:1,name:"力揚彰銀臨停一",bankCode:"009",account:"41150119912401"},{id:3,companyId:1,bankMemo:"悠遊卡公司",voucherDesc:"悠遊卡",message:"悠遊卡舊系統",bankId:1,name:"力揚彰銀臨停",bankCode:"009",account:"41150119912406"}],this.getCashFlowSources(),this.getBankAccountSources()},getCashFlowSources(){this.cashFlowSources=this.searchOrigin.map(t=>t.bankMemo.trim())},getBankAccountSources(){this.bankAccounts=this.searchOrigin.map(t=>({name:t.name.trim(),account:`${t.bankCode}${t.account}`}))},show(){if(this.searchData.date!==""&&this.searchData.cashFlowSource!==""&&this.searchData.bankAccount!==""){const t=Y.service({lock:!0,text:"比對中...",background:"rgba(0, 0, 0, 0.7)"});setTimeout(()=>{t.close(),this.countBankFlow=null,this.totalBankFlow=null,this.countSystemFlow=null,this.totalSystemFlow=null,this.compare()},2e3)}else alert("搜尋欄位不得為空！")},getBankFlow(){this.bankFlow=[{id:1,station:"",postingDate:"2024-01-01",depositAmount:1e3,note:"這是備註訊息"},{id:2,station:"",postingDate:"2024-01-01",depositAmount:1300,note:""},{id:3,station:"",postingDate:"2024-01-01",depositAmount:1200,note:"這是備註訊息"},{id:4,station:"",postingDate:"2024-01-01",depositAmount:900,note:""},{id:5,station:"",postingDate:"2024-01-01",depositAmount:500,note:""}],this.countBankFlow=this.bankFlow.length,this.bankFlow.forEach(t=>{this.totalBankFlow+=t.depositAmount})},getSystemFlow(){this.systemFlow=[{id:64,postingDate:"2024-01-01",transactionAmount:515,fee:15,depositAmount:500,transactionCode:"y11111111",station:"富岡停一停車場",department:"部門一"},{id:98,postingDate:"2024-01-01",transactionAmount:915,fee:15,depositAmount:900,transactionCode:"y22222222",station:"南崁廣停一",department:"部門二"},{id:119,postingDate:"2024-01-01",transactionAmount:1315,fee:15,depositAmount:1300,transactionCode:"y33333333",station:"瑞芳消防分隊營業所",department:"部門一"},{id:191,postingDate:"2024-01-01",transactionAmount:515,fee:15,depositAmount:500,transactionCode:"y44444444",station:"桃園停三",department:"部門一"},{id:199,postingDate:"2024-01-01",transactionAmount:515,fee:15,depositAmount:500,transactionCode:"y55555555",station:"桃園停一",department:"部門二"}],this.countSystemFlow=this.systemFlow.length,this.systemFlow.forEach(t=>{this.totalSystemFlow+=t.depositAmount})},handleSystemFlowChange(t){alert("修改成功"),console.log(t)},amountFormatter(t,l,c){return c+="",c.includes(".")||(c+="."),c.replace(/(\d)(?=(\d{3})+\.)/g,function(C,o){return o+","}).replace(/\.$/,"")},compare(){this.getBankFlow(),this.getSystemFlow(),this.bankFlow.forEach(t=>{const l=this.systemFlow.find(c=>c.depositAmount===t.depositAmount);l&&(t.station=l.station)}),console.log("比對完啦",this.bankFlow)},customRowClassName({row:t}){return t.station!==""?"bg-success text-white":""},customSystemRowClassName({row:t}){return this.bankFlow.some(c=>c.station===t.station&&c.postingDate===t.postingDate)?"bg-success text-white":""},openDetailDialog(t){console.log(t.row),this.dialogTableVisible=!0,this.getDetail()},getDetail(){this.systemFlowDetails=[{outDate:"2024-01-01",transactionTime:"12:30:43",amount:80},{outDate:"2024-01-01",transactionTime:"14:11:34",amount:120},{outDate:"2024-01-01",transactionTime:"16:51:11",amount:160},{outDate:"2024-01-01",transactionTime:"18:40:51",amount:160},{outDate:"2024-01-01",transactionTime:"18:53:20",amount:80},{outDate:"2024-01-01",transactionTime:"19:11:45",amount:200},{outDate:"2024-01-01",transactionTime:"19:41:38",amount:160},{outDate:"2024-01-01",transactionTime:"20:28:54",amount:40},{outDate:"2024-01-01",transactionTime:"21:53:28",amount:200}]},handleDetailAmountChange(t){t.outDate!==null&t.amount!==""?(console.log("交易明細變更",t),alert("修改成功")):alert("修改欄位不得為空！")},transfer(){this.transferData=this.bankFlow.filter(t=>t.station!=""),this.transferData.length>0?(this.bankFlow=this.bankFlow.filter(t=>t.station==""),alert("完成轉傳票"),console.log("轉傳票",this.transferData)):alert("無可以轉傳票的資料！")}},mounted(){this.getSearchOrigin()}},x={class:"container"},B=n("h1",{class:"my-3 text-center"},"對帳系統",-1),T={class:"row align-items-center"},N={class:"col-md-3"},U={class:"col-md-3"},E={class:"col-md-3"},O={class:"col-md-2 mobile-btns"},I=n("p",{class:"text-end"},[n("br"),n("span",{class:"bg-success text-white p-1"},"綠底標註"),u("為符合的比對結果 ")],-1),R={class:"row"},L={class:"col-md-6"},j=n("h2",{class:"text-center my-2"},"銀行帳",-1),P={key:0,class:"text-end"},q={class:"col-md-6"},z=n("h2",{class:"text-center my-2"},"系統帳",-1),G={key:0,class:"text-end"},H={class:"d-flex justify-content-between"};function J(t,l,c,C,o,i){const w=d("el-date-picker"),f=d("el-option"),_=d("el-select"),s=d("el-table-column"),b=d("el-table"),D=d("el-button"),v=d("el-dialog");return m(),p("div",x,[B,n("form",T,[n("div",N,[a(w,{class:"align-self-stretch",style:{width:"100%"},modelValue:o.searchData.date,"onUpdate:modelValue":l[0]||(l[0]=e=>o.searchData.date=e),type:"date",placeholder:"請選擇入帳日期",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD","disabled-date":o.disabledDate,clearable:!1},null,8,["modelValue","disabled-date"])]),n("div",U,[a(_,{modelValue:o.searchData.cashFlowSource,"onUpdate:modelValue":l[1]||(l[1]=e=>o.searchData.cashFlowSource=e),placeholder:"請選擇金流來源"},{default:r(()=>[(m(!0),p(y,null,A(o.cashFlowSources,e=>(m(),S(f,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",E,[a(_,{modelValue:o.searchData.bankAccount,"onUpdate:modelValue":l[2]||(l[2]=e=>o.searchData.bankAccount=e),placeholder:"請選擇銀行來源"},{default:r(()=>[(m(!0),p(y,null,A(o.bankAccounts,e=>(m(),S(f,{key:e.account,label:e.account,value:e.account},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",O,[n("button",{class:"btn btn-success",onClick:l[3]||(l[3]=F((...e)=>i.show&&i.show(...e),["prevent"]))},"顯示"),n("button",{class:"btn btn-outline-success",onClick:l[4]||(l[4]=F((...e)=>i.transfer&&i.transfer(...e),["prevent"]))},"轉傳票")])]),I,n("div",R,[n("div",L,[j,o.countBankFlow>0?(m(),p("p",P,[u(" 共  "),n("strong",null,g(o.countBankFlow),1),u("  筆 "),n("span",null,[u("  / 總金額 $ "),n("strong",null,g(o.totalBankFlow.toLocaleString("en",{minimumFractionDigits:0})),1)])])):k("",!0),a(b,{data:o.bankFlow,"row-style":{height:"50px"},"row-class-name":i.customRowClassName,height:"450"},{default:r(()=>[a(s,{align:"center",prop:"station",label:"場站名稱",width:"180"}),a(s,{align:"center",prop:"postingDate",label:"入帳日",width:"180"}),a(s,{align:"center",prop:"depositAmount",sortable:"",formatter:i.amountFormatter,label:"入帳金額",width:"110"},null,8,["formatter"]),a(s,{align:"center",prop:"note",label:"註記",width:"180"})]),_:1},8,["data","row-class-name"])]),n("div",q,[z,o.countSystemFlow>0?(m(),p("p",G,[u(" 共  "),n("strong",null,g(o.countSystemFlow),1),u("  筆 "),n("span",null,[u("  / 總金額 $ "),n("strong",null,g(o.totalSystemFlow.toLocaleString("en",{minimumFractionDigits:0})),1)])])):k("",!0),a(b,{data:o.systemFlow,"row-style":{height:"50px"},"row-class-name":i.customSystemRowClassName,height:"450"},{default:r(()=>[a(s,{align:"center",prop:"station",label:"場站名稱",width:"180"}),a(s,{align:"center",prop:"postingDate",label:"入帳日",width:"210"},{default:r(e=>[n("div",H,[a(w,{class:"align-self-stretch",style:{width:"100%"},modelValue:e.row.postingDate,"onUpdate:modelValue":h=>e.row.postingDate=h,type:"date",placeholder:"請選擇入帳日期",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD","disabled-date":o.disabledDate,clearable:!1},null,8,["modelValue","onUpdate:modelValue","disabled-date"]),a(D,{onClick:h=>i.handleSystemFlowChange(e.row)},{default:r(()=>[u("確認")]),_:2},1032,["onClick"])])]),_:1}),a(s,{align:"center",prop:"depositAmount",sortable:"",formatter:i.amountFormatter,label:"入帳金額",width:"110"},null,8,["formatter"]),a(s,{align:"center",prop:"transactionAmount",sortable:"",formatter:i.amountFormatter,label:"交易金額",width:"110"},null,8,["formatter"]),a(s,{align:"center",prop:"fee",sortable:"",formatter:i.amountFormatter,label:"手續費",width:"110"},null,8,["formatter"]),a(s,{align:"center",prop:"transactionCode",label:"交易代號",width:"100"}),a(s,{align:"center",prop:"department",label:"部門",width:"100"}),a(s,{align:"center",label:"明細",width:"120",fixed:"right"},{default:r(e=>[a(D,{onClick:h=>i.openDetailDialog(e)},{default:r(()=>[u("查看明細")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","row-class-name"])]),a(v,{modelValue:o.dialogTableVisible,"onUpdate:modelValue":l[5]||(l[5]=e=>o.dialogTableVisible=e),"close-on-click-modal":!1,align:"center",title:"交易明細",width:"70vw"},{default:r(()=>[a(b,{data:o.systemFlowDetails,height:"500"},{default:r(()=>[a(s,{align:"center",property:"outDate",label:"入帳日期"},{default:r(e=>[a(w,{class:"align-self-stretch",modelValue:e.row.outDate,"onUpdate:modelValue":h=>e.row.outDate=h,type:"date",placeholder:"請選擇入帳日期",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD","disabled-date":o.disabledDate,clearable:!1},null,8,["modelValue","onUpdate:modelValue","disabled-date"])]),_:1}),a(s,{align:"center",property:"transactionTime",label:"交易時間",sortable:""}),a(s,{align:"center",property:"amount",label:"金額",sortable:"",formatter:i.amountFormatter},null,8,["formatter"]),a(s,{align:"center",label:"調整"},{default:r(e=>[a(D,{onClick:h=>i.handleDetailAmountChange(e.row)},{default:r(()=>[u("確認調整")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])])}const Q=V(M,[["render",J]]);export{Q as default};
