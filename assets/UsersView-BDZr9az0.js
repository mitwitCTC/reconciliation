import{_ as D,A as f,c as y,a as u,t as _,b as s,w as l,r as g,o as x,d as n}from"./index-KQMgRxY9.js";const C={data(){return{pageTitle:"",users:[],addDialogVisible:!1,editDialogVisible:!1,deleteDialogVisible:!1,isEditing:!1,currentUser:{},editUserData:{},deleteUserData:{},userFormRules:{userName:[{required:!0,message:"請輸入使用者名稱",trigger:"blur"}],account:[{required:!0,message:"請輸入帳號",trigger:"blur"}],password:[{required:!0,message:"請輸入原密碼",trigger:"blur"}],newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"}],againPassword:[{required:!0,message:"請再次輸入新密碼",trigger:"blur"}]}}},methods:{getPageTitle(){this.pageTitle=this.$route.name},getUsers(){const o=`${f}/user/searchUser`;this.axios.get(o).then(e=>{this.users=e.data.data})},openUserDialog(o){o?(this.currentUser={...o},this.currentUser.password="",this.isEditing=!0,this.editDialogVisible=!0):(this.addDialogVisible=!0,this.currentUser={userName:"",account:"",password:""},this.isEditing=!1)},cancelAddUser(){this.addDialogVisible=!1,this.currentUser={}},addUser(){this.$refs.userForm.validate(o=>{if(o){const e=`${f}/user/insertUser`;this.axios.post(e,this.currentUser).then(a=>{a.data.returnCode==0?(alert(a.data.message),this.getUsers(),this.addDialogVisible=!1):alert(a.data.message)})}})},cancelEditUser(){this.editDialogVisible=!1,this.currentUser={}},async editUser(){try{if(await this.$refs.userForm.validate(),!await this.verifyOriginalPassword(this.currentUser.password)){alert("原密碼不正確");return}if(this.currentUser.newPassword!==this.currentUser.againPassword){alert("新密碼和確認密碼不一致");return}const a=`${f}/user/updateUser`;this.axios.post(a,{id:this.currentUser.id,password:this.currentUser.newPassword}).then(w=>{w.data.returnCode==0&&(alert("成功修改使用者密碼，請重新登入"),sessionStorage.removeItem("isAuthenticated"),this.$router.push("/login"),this.editDialogVisible=!1)})}catch(o){console.error(o)}},async verifyOriginalPassword(o){const e=`${f}/user/login`;try{return(await this.axios.post(e,{account:this.currentUser.account,password:o})).data.data.length===1}catch(a){return console.error("Error verifying password:",a),!1}},openDeleteUserDialog(o){this.deleteDialogVisible=!0,this.deleteUserData=o},deleteUser(){const o=`${f}/user/deleteUser`;this.axios.post(o,{id:this.deleteUserData.id}).then(e=>{e.data.returnCode==0?(alert(e.data.message),this.getUsers()):alert(e.data.message),this.deleteDialogVisible=!1})}},mounted(){this.getPageTitle(),this.getUsers()},computed:{dialogTitle(){return this.isEditing?"修改使用者":"新增使用者"}}},v={class:"container justify-content-center"},P={class:"d-flex justify-content-center align-items-center"},k={class:"flex-grow-1 text-center"},N={class:"dialog-footer d-flex justify-content-end"},A={class:"dialog-footer d-flex justify-content-end"},T={class:"d-flex flex-column"},E={class:"row mb-2 justify-content-center"},F=u("div",{class:"col-3 text-end"},"使用者帳號",-1),j={class:"col-4 text-start fw-bold"},q={class:"dialog-footer d-flex justify-content-end"};function B(o,e,a,w,t,i){const d=g("el-button"),p=g("el-table-column"),b=g("el-table"),c=g("el-input"),m=g("el-form-item"),V=g("el-form"),U=g("el-dialog");return x(),y("div",v,[u("div",P,[u("h2",k,_(t.pageTitle),1),s(d,{class:"ms-auto",onClick:e[0]||(e[0]=r=>i.openUserDialog())},{default:l(()=>[n("新增")]),_:1})]),s(b,{data:t.users,height:"600"},{default:l(()=>[s(p,{align:"center",prop:"userName",label:"使用者名稱"}),s(p,{align:"center",prop:"taxNumber",label:"帳號"}),s(p,{align:"center",label:"修改密碼",fixed:"right"},{default:l(r=>[s(d,{onClick:h=>i.openUserDialog(r.row)},{default:l(()=>[n("修改")]),_:2},1032,["onClick"])]),_:1}),s(p,{align:"center",label:"刪除",fixed:"right"},{default:l(r=>[s(d,{type:"danger",onClick:h=>i.openDeleteUserDialog(r.row)},{default:l(()=>[n("刪除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),s(U,{modelValue:t.addDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=r=>t.addDialogVisible=r),title:i.dialogTitle,width:"500",center:""},{default:l(()=>[s(V,{model:t.currentUser,"label-width":"auto",rules:t.userFormRules,ref:"userForm"},{default:l(()=>[s(m,{label:"使用者名稱",prop:"userName"},{default:l(()=>[s(c,{modelValue:t.currentUser.userName,"onUpdate:modelValue":e[1]||(e[1]=r=>t.currentUser.userName=r)},null,8,["modelValue"])]),_:1}),s(m,{label:"帳號",prop:"account"},{default:l(()=>[s(c,{modelValue:t.currentUser.account,"onUpdate:modelValue":e[2]||(e[2]=r=>t.currentUser.account=r)},null,8,["modelValue"])]),_:1}),s(m,{label:"密碼",prop:"password"},{default:l(()=>[s(c,{type:"password",modelValue:t.currentUser.password,"onUpdate:modelValue":e[3]||(e[3]=r=>t.currentUser.password=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),u("div",N,[s(d,{onClick:i.cancelAddUser},{default:l(()=>[n("取消")]),_:1},8,["onClick"]),s(d,{type:"primary",onClick:i.addUser},{default:l(()=>[n("確定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"]),s(U,{modelValue:t.editDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=r=>t.editDialogVisible=r),title:i.dialogTitle,width:"500",center:""},{default:l(()=>[s(V,{model:t.currentUser,"label-width":"auto",rules:t.userFormRules,ref:"userForm"},{default:l(()=>[s(m,{label:"使用者名稱",prop:"userName"},{default:l(()=>[s(c,{modelValue:t.currentUser.userName,"onUpdate:modelValue":e[5]||(e[5]=r=>t.currentUser.userName=r),disabled:""},null,8,["modelValue"])]),_:1}),s(m,{label:"帳號",prop:"account"},{default:l(()=>[s(c,{modelValue:t.currentUser.account,"onUpdate:modelValue":e[6]||(e[6]=r=>t.currentUser.account=r),disabled:""},null,8,["modelValue"])]),_:1}),s(m,{label:"原密碼",prop:"password"},{default:l(()=>[s(c,{type:"password",modelValue:t.currentUser.password,"onUpdate:modelValue":e[7]||(e[7]=r=>t.currentUser.password=r)},null,8,["modelValue"])]),_:1}),s(m,{label:"新密碼",prop:"newPassword"},{default:l(()=>[s(c,{type:"password",modelValue:t.currentUser.newPassword,"onUpdate:modelValue":e[8]||(e[8]=r=>t.currentUser.newPassword=r)},null,8,["modelValue"])]),_:1}),s(m,{label:"密碼確認",prop:"againPassword"},{default:l(()=>[s(c,{type:"password",modelValue:t.currentUser.againPassword,"onUpdate:modelValue":e[9]||(e[9]=r=>t.currentUser.againPassword=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),u("div",A,[s(d,{onClick:i.cancelEditUser},{default:l(()=>[n("取消")]),_:1},8,["onClick"]),s(d,{type:"primary",onClick:i.editUser},{default:l(()=>[n("確定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","title"]),s(U,{modelValue:t.deleteDialogVisible,"onUpdate:modelValue":e[12]||(e[12]=r=>t.deleteDialogVisible=r),title:"刪除使用者",width:"500",center:""},{default:l(()=>[u("div",T,[u("div",E,[F,u("div",j,_(t.deleteUserData.account),1)])]),u("div",q,[s(d,{onClick:e[11]||(e[11]=r=>t.deleteDialogVisible=!1)},{default:l(()=>[n("取消")]),_:1}),s(d,{type:"danger",onClick:i.deleteUser},{default:l(()=>[n("確定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"])])}const I=D(C,[["render",B]]);export{I as default};
